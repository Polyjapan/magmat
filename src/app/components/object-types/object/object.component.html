<mat-spinner *ngIf="!object"></mat-spinner>

<div *ngIf="object" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">

  <div fxFlex fxLayout="column" fxLayoutGap="20px">
    <mat-card>
      <mat-card-title>Détails de l'objet :: {{object.objectType.name}} {{object.object.suffix}}</mat-card-title>

      <mat-card-content>
        <button [routerLink]="['..', 'update', object.object.objectId]" mat-stroked-button><mat-icon>edit</mat-icon> Modifier l'objet</button>
        <button (click)="delete()" mat-stroked-button><mat-icon>delete</mat-icon> Supprimer l'objet</button>
        <button [routerLink]="['/', 'object-types', object.object.objectTypeId]" mat-stroked-button><mat-icon>keyboard_backspace</mat-icon> Retour au type de l'objet</button>

        <ul>
          <li *ngIf="object.object.assetTag"><b>Asset Tag</b> : <code>{{object.object.assetTag}}</code></li>
          <li><b>Description
            :</b> {{object.object.description ? object.object.description : object.objectType.description }} <i
            *ngIf="!object.object.description">(hérité)</i></li>
          <li><b>Stockage hors convention :</b> {{storageLocationToString(object.storageLocationObject, 'N/A')}} <i
            *ngIf="!object.object.storageLocation">(hérité)</i></li>
          <li><b>Stockage en convention :</b> {{storageLocationToString(object.inconvStorageLocationObject, 'N/A')}} <i
            *ngIf="!object.object.inconvStorageLocation">(hérité)</i></li>
          <li><b>Prêt parent : </b><a *ngIf="object.partOfLoanObject" [routerLink]="['/', 'external-loans', object.partOfLoanObject.externalLoan.externalLoanId]">{{object.partOfLoanObject.externalLoan.loanTitle}}</a> <span *ngIf="!object.partOfLoanObject">N/A</span>
            <i *ngIf="!object.object.partOfLoan"> (hérité)</i></li>
          <li><b>Réservé pour :</b> {{object.object.reservedFor ? object.reservedFor.details.firstName + ' ' + object.reservedFor.details.lastName + ' (' + object.object.reservedFor + ')' : 'Personne'}}</li>
          <li *ngIf="object.object.plannedUse"><b>Utilisation prévue :</b> {{object.object.plannedUse}}</li>
          <li *ngIf="object.object.depositPlace"><b>Lieu de dépose :</b> {{object.object.depositPlace}}</li>
          <li><b>Etat acutel :</b> {{statusToString(object.object.status)}}</li>
        </ul>

      </mat-card-content>


    </mat-card>


    <mat-card>
      <mat-card-title>Ajout de commentaire</mat-card-title>

      <form (ngSubmit)="sendComment()">
        <mat-form-field style="width: 100%;">
          <input matInput placeholder="Commentaire..." required maxlength="5000" name="comment" [(ngModel)]="comment" />
        </mat-form-field>

        <button mat-stroked-button style="float: right;" type="submit" [disabled]="posting">Envoyer</button>
      </form>
    </mat-card>

    <mat-card *ngIf="comments && comments.length > 0">
      <mat-card-title>Commentaires de l'objet</mat-card-title>

      <mat-list class="mat-elevation-z3">
        <mat-list-item *ngFor="let com of comments">
          <h4 mat-line>{{com.writer.details.firstName}} {{com.writer.details.lastName}} - {{dateFormat(com)}}</h4>
          <p mat-line>{{com.objectComment.comment}}</p>
        </mat-list-item>
      </mat-list>

      <mat-spinner *ngIf="!comments"></mat-spinner>
    </mat-card>
  </div>

  <div fxFlex="60%" fxFlex.lt-md="100%" fxLayout="column" fxLayoutGap="20px">

    <mat-card>
      <mat-card-title>Changement d'état</mat-card-title>

      <app-quick-changestate [object]="object" (update)="refresh()"></app-quick-changestate>
    </mat-card>

    <mat-card>
      <mat-card-title>Historique de l'objet</mat-card-title>


      <table mat-table [dataSource]="logs" class="mat-elevation-z4" style="width: 100%;">
        <ng-container matColumnDef="timestamp">
          <th mat-header-cell *matHeaderCellDef> Heure</th>
          <td mat-cell *matCellDef="let elem"> {{dateFormat(elem)}} </td>
        </ng-container>

        <ng-container matColumnDef="source">
          <th mat-header-cell *matHeaderCellDef> Ancien état</th>
          <td mat-cell *matCellDef="let elem"> {{statusToString(elem.objectLog.sourceState)}} </td>
        </ng-container>

        <ng-container matColumnDef="target">
          <th mat-header-cell *matHeaderCellDef> Nouvel état</th>
          <td mat-cell *matCellDef="let elem"> {{statusToString(elem.objectLog.targetState)}} </td>
        </ng-container>

        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef> Utilisateur</th>
          <td mat-cell *matCellDef="let elem"><b>{{elem.user.details.firstName}} {{elem.user.details.lastName}}</b>
            ({{elem.user.details.phoneNumber}})
          </td>
        </ng-container>

        <ng-container matColumnDef="admin">
          <th mat-header-cell *matHeaderCellDef> Administrateur</th>
          <td mat-cell
              *matCellDef="let elem">{{elem.changedBy.details.firstName}} {{elem.changedBy.details.lastName}}</td>
        </ng-container>
        <ng-container matColumnDef="signature">
          <th mat-header-cell *matHeaderCellDef> Signature</th>
          <td mat-cell
              *matCellDef="let elem"><img *ngIf="elem.objectLog.signature" [src]="elem.objectLog.signature" width="400px" /></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['timestamp', 'source', 'target', 'user', 'admin', 'signature']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['timestamp', 'source', 'target', 'user', 'admin', 'signature'];"></tr>
      </table>
    </mat-card>
  </div>


</div>


